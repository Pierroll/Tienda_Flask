{% extends 'base.html' %}

{% block title %}Lista de Productos{% endblock %}

{% block styles %}
<style>
    /* Variables para adaptarse al tema base */
    :root {
        --theme-bg: var(--bg-color, #ffffff);
        --theme-text: var(--text-color, #333333);
        --theme-border: var(--border-color, #dee2e6);
    }

    /* Estilos para la sección de búsqueda */
    .search-section {
        background-color: var(--theme-bg);
        color: var(--theme-text);
        border: 1px solid var(--theme-border);
    }
</style>
{% endblock %}

{% block body %}
<div class="container my-4">
    <div class="bg-white p-3 rounded shadow-sm mb-3">
        <div class="d-flex justify-content-between align-items-center">
            <h2 class="m-0" style="color: #333;">Lista de Productos</h2>
            {% if current_user.is_admin %}
            <a href="{{ url_for('views.add_product') }}" class="btn" style="background-color: #2ecc71; border-color: #27ae60; color: white;">
                <i class="fas fa-plus"></i> Agregar Producto
            </a>
            {% endif %}
        </div>
    </div>

    <!-- Filtro de Búsqueda -->
<div class="search-section p-3 rounded shadow-sm mb-3" style="border: 2px solid #ff6600;">
    <form method="GET" class="row g-3">
        <div class="col-md-4">
            <label class="form-label">Categoría</label>
            <select name="category" class="form-select">
                <option value="">Todas las categorías</option>
                {% for category in categories %}
                <option value="{{ category.id }}" {% if selected_category == category.id %}selected{% endif %}>
                    {{ category.name }}
                </option>
                {% endfor %}
            </select>
        </div>

        <div class="col-md-4">
            <label class="form-label">Buscar</label>
            <input type="text" name="search" class="form-control" placeholder="Buscar productos..." value="{{ search_query }}">
        </div>

        <div class="col-md-4">
            <label class="form-label">Ordenar por</label>
            <select name="sort" class="form-select">
                <option value="name_asc" {% if sort == 'name_asc' %}selected{% endif %}>Nombre (A-Z)</option>
                <option value="name_desc" {% if sort == 'name_desc' %}selected{% endif %}>Nombre (Z-A)</option>
                <option value="price_asc" {% if sort == 'price_asc' %}selected{% endif %}>Precio (Menor a Mayor)</option>
                <option value="price_desc" {% if sort == 'price_desc' %}selected{% endif %}>Precio (Mayor a Menor)</option>
            </select>
        </div>

        <div class="col-12 d-flex justify-content-center mt-2">
            <button type="submit" class="btn btn-primary me-2">Filtrar</button>
            <a href="{{ url_for('views.list_products') }}" class="btn btn-secondary">Limpiar</a>
        </div>
    </form>
</div>


    <!-- Tabla de Productos -->
    {% if items %}
    <div class="table-responsive rounded shadow-sm">
        <table class="table table-dark table-striped table-hover align-middle text-center">
            <thead class="table-primary">
                <tr>
                    <th>ID</th>
                    <th>Imagen</th>
                    <th>Nombre</th>
                    <th>Precio Actual</th>
                    <th>Precio Anterior</th>
                    <th>Stock</th>
                    <th>Oferta Flash</th>
                    <th>Fecha Agregado</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr>
                    <td>{{ item.id }}</td>
                    <td>
                        <a href="{{ item.product_picture }}" target="_blank">
                            <img src="{{ item.product_picture }}" alt="{{ item.product_name }}" width="50" height="50" style="border-radius: 8px;">
                        </a>
                    </td>
                    <td>{{ item.product_name }}</td>
                    <td>${{ item.current_price }}</td>
                    <td>${{ item.previous_price }}</td>
                    <td>
                        {% if item.in_stock > 10 %}
                            <span class="badge bg-success">Alta</span>
                        {% elif item.in_stock > 0 %}
                            <span class="badge bg-warning text-dark">Media</span>
                        {% else %}
                            <span class="badge bg-danger">Baja</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if item.flash_sale %}
                            <span class="badge bg-info">Sí</span>
                        {% else %}
                            <span class="badge bg-secondary">No</span>
                        {% endif %}
                    </td>
                    <td>{{ item.date_added.strftime('%Y-%m-%d %H:%M') }}</td>
                    <td>
                        {% if current_user.is_admin %}
                        <div class="d-flex gap-1 justify-content-center">
                            <a href="{{ url_for('views.edit_item', item_id=item.id) }}" class="btn btn-sm" style="background-color: #f1c40f; border-color: #f39c12; color: black;">Editar</a>
                            <a href="{{ url_for('views.delete_item', item_id=item.id) }}" 
                               class="btn btn-sm" 
                               style="background-color: #e74c3c; border-color: #c0392b; color: white;"
                               onclick="return confirm('¿Estás seguro de que deseas eliminar este producto?')">Eliminar</a>
                        </div>
                        {% else %}
                            <a href="{{ url_for('views.add_to_cart', item_id=item.id) }}" class="btn btn-sm" style="background-color: #2ecc71; border-color: #27ae60; color: white;">Comprar</a>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="alert alert-warning text-center">
        No hay productos en la base de datos.
    </div>
    {% endif %}
</div>
{% endblock %}
